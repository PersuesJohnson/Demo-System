### 大数据下人身份识别系统建立

#### 模型简介

##### 模型主要功能

* 利用爬虫在网上进行挖掘，得到人脸特征对应的URL，并且写入数据库中。如果找到了这个人的特征，则把这个人的URL显示在屏幕上。

* 每晚12点后自动对于数据库中没有找到的人的URL进行统一的更新（过于频繁有被系里封掉端口的风险），并且将其补全。

* 通过某种naive的方式建立人和人之间的关系网络，从而构建关系图谱。现阶段的方法有两种，一是在互联网上爬下的照片中处于同一张照片的两个人，我们认为他们互相认识，认识频数+1；另一种则是在摄像头中出现的时间间隔不超过10s的两个人，同样我们认为他们认识，两者熟悉度+1。通过熟悉度的排序来取得最有可能认识的人。

##### 模型组成

* 数据库部分(Demo-System/database下各个文件)
* 图像处理部分(Demo-System/imgproc下各个文件)
* 前端及摄像头信息读取部分(Demo-System/Gui下的文件及UIMain)
* 爬虫部分(Demo-System/spider以及name.py等文件，内容比较繁杂，之后可能需要直接进行合并和筛选)

##### 数据库部分
* 有效文件只有Database.py，其余的几个都是备份或者先前版本。

* 依赖于neo4j的python接口(py2neo)进行数据的整理。对人信息的查找通过暴力多线程搜索在内存中保存的数据库映射备份表实现。

* 主函数部分调用DatabaseBase函数实现第二进程，进程与主程序独立，提高整个程序运行效率。

* 主函数会调用Query或者其他的子函数进行数据库的内容查询，插入等操作。

##### 爬虫部分

* 所有含有spider、name、in以及search的在Demo-system根目录下的都是爬虫部分，需要进一步合并规整，建议重写。

* spider123分别实现的应该是通过照片进行信息查找以及一些其他的功能（时间有些久我忘了这哥们当初写的是什么了。。。），name是根据姓名进行身份信息、照片信息的查找，inSamePht是在网上随意爬信息时，对于处于同一张照片上的两个人的身份信息识别和识别度提升。Search_in_single_school是希望实现在清华校内的查询（目前仅仅实现了EE和部分的CS）。

* 新的爬虫只需要实现对网页人脸的识别和URL的保存就可以了，比起之前的保存信息式爬虫要简单。#TODO

##### 图像处理部分(Demo-System/imgproc)

* 图像处理部分分为活体检测模块（liveness_detection、featureCal以及LBP等有关文件）和人脸检测和特征提取部分（face_detection和face_detection_for_spider），通过已经训练好的caffe模型实现人脸检测和识别。

* 活体检测部分参考的是Secure Face Unlock: Spoof Detection on Smartphones（细节可以无视，有一些小的改动），降低照片等信息对于整个的数据库的影响。

* 人脸识别部分参考的是 Toward End-to-End Face Recognition Through Alignment Learning中的实现，而人脸检测采用的是改写后的GoogleNet模型，从人脸的RGB图像中提取512维归一化后的向量作为最终的信息。

##### 前端部分&&主函数（UIMain）

* 这是一个和database并行的线程，在前段进行摄像头得到的信息读取，获取信息送给后端，并且从后端读取信息在前端窗口中现实。

* 前端创立一个比较脏的表，当这个表写满的时候或者经历了一段较长的时间之后，表中的内容会向数据库中写一次，从而使得前端和后端能够同步。(这个前端还是比较古老的，更新后的前端在查找的时候会新开一个进程，防止在查找信息时候出现的卡死现象发生，并且能够较为稳定的显示。并且前端会创建一个新的查找表，独立于数据库并且和数据库每天同步一次，从而减少在查找中浪费的时间。如果之后的数据库查询效率能更高一些，搜索树能写的更好些就能忽略这项内容)。

##### 主要的环境和python的库依赖

* python 3.5.2
* numpy
* opencv 3.0之后的版本
* 基于opencv3.0后版本的caffe（这个可以从服务器上扒下来）及pycaffe
* PyQt5
* tempfile
* pillow库
* gtts（暂时用于语音库，更新的版本是用的baidu的API，但现在线上版本是该库实现语音播放）
* py2neo

#### To do list

* 爬虫部分重新构建。
* 应用范围推广，实现全校各个系别网站的信息读取处理。
* 设计出一个较为合理的查询范围定向方案，实现更大范围的定向信息搜寻，减少搜索的复杂度。
* 将整个系统整合到服务器，前端进一步美观设计。
